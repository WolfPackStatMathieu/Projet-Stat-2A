---
title: "Cahier de suivi Projet Statistique Sujet 23"
author: "NEBANGA KANGA-NZANGA Odilon cyrille, GORSE Nathan, THOMASSIN Mathieu"
date: "`r Sys.Date()`"
output: html_document
editor_options: 
  markdown: 
    wrap: 72
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## 1 To do list

-   Revoir modèle de survie et vraisemblance
-   Tenter écrire vraisemblance du modèle de guérison (produit des
    contributions des sujets dans les deux sous-populations)
-   Données
-   
    -   Utiliser modèle puissance pour analyse données
-   
    -   Utiliser modèle de survie après avoir simulé des délais
-   $\mathrm{R}$
-   dfcrm Code joint
-   Fonctions article anais andrillon

### 1 Revoir modèle de survie et vraisemblance

La fonction de survie du modèle de guérison vaut : $$
P(T>=t)=\pi(z)*S_{U}(T>=t)+1-\pi(z) (1)
$$

### 2 Tenter écrire vraisemblance du modèle de guérison (produit des contributions des sujets dans les deux sous-populations)

Pour écrire la vraisemblance du modèle, il faut distinguer deux cas.
Dans le premier cas, on connaît la valeur de T qui n'a pas été censurée.
L'individu a par conséquent bien manifesté la toxicité dans la fenêtre
[0,t\*]. La contribution pour ces individus à la vraisemblance
correspond alors à la fonction de densité sachant U(Y=1) soit : $$
f(t_i|xi)=\pi(x_{i})*f_{U}(t)
$$ A l'inverse, pour les individus n'ayant pas manifesté la toxicité
durant cette fenêtre, on ne connaît pas T. Autrement dit, Y=0. Par
conséquent, on sait juste que T est supérieure à une certaine valeur. On
mobilise par conséquent la fonction de survie donnée dans l'équation
(1). La vraisemblance vaut donc :

$$
L(X,Y)= \prod_{i=1}^{n} \pi(x_{i}) * f_{U}(t_{i})^{Y_{i}} * S(t_{i}|x_{i})^{1-Y_{i}}$$
$$
=\prod_{i=1}^{n} \pi(x_{i}) f_{U}(t_{i})^{Y_{i} }* \left(S_{U} \left(t_{i} \right)*\pi \left( x_{i} \right)+\left( 1-\pi \left( x_{i} \right) \right) \right)^{1-Y_{i}}
$$

## 3 Utiliser modèle puissance pour analyse données

### Utilisation de CRM Installation du package

```{r}
require(dfcrm)
# help(dfcrm)
```

Nous entrons les données des doses administrées à chaque patient telles
qu'indiqués dans la colonne de gauche du tableau suivant.

$$
\begin{array}{cc}
\begin{array}{c}
\text { Administrated dose } \\
\left.\mathbf{( m g g ~ m}^{-2} \mathbf{d a y}^{-\mathbf{1}}\right)
\end{array} & \begin{array}{c}
\text { Clinical } \\
\text { response }
\end{array} \\
\hline 0.5 & \text { NT NT NT } \\
3 & \text { NT NT T } \\
5 & \text { NT NT T } \\
5 & \text { NT NT NT } \\
5 & \text { NT T NT } \\
5 & \text { T NT T } \\
\hline
\end{array}
$$

```{r}
vecteur_dose<-c(rep(0.5,3),rep(3,3),rep(5,4*3))
```

Puis les données de l'effet du traitement sur chaque patient ("Clinical
response").

```{r}
vecteur_reponse<-c(rep(0,3),0,0,1,0,0,1,rep(0,3),0,1,0,1,0,1)
```

Nous faisons un dataframe reliant ces deux vecteurs.

```{r}
valeurs_dose_toxicite<-cbind.data.frame(vecteur_dose,vecteur_reponse)
```

Nous entrons les valeurs de probabilités de toxicité des doses a priori
fournies par le tableau suivant:

$$
\begin{array}{ccccccccc}
\hline \text{HHT-loading dose } \left(\mathbf{m g ~ m}^{-2}\right. day \left.^{-1}\right) & 0.5 & 1 & 3 & 5 & 6\\
\hline \text {Initial guesses of toxicity probability } & 0.05 & 0.1 & 0.15 & 0.33 & 0.50\\
\hline
\end{array}
$$

```{r}
prior_probabilities <- c(0.05,0.1,0.15,0.33,0.5) 
```

Nous assignons la valeur de toxicité limitante (Dose Limiting Toxicity)

```{r}
p <- 0.33
```

Nous appliquons la fonction crm aux données, avec le modèle puissance et
affichons les données

```{r}
infos<-crm(prior=prior_probabilities,target=p,vecteur_reponse,vecteur_dose,18) # puissance avec empiric 
```

```{r echo=FALSE}
plot.mtd(infos)
```

### 4 Utiliser modèle de survie après avoir simulé des délais
